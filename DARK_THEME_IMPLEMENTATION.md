# 暗黑主题切换功能实现文档

## 功能概述

为KkWiki网站添加了完整的暗黑主题切换功能，支持亮色和暗色两种主题模式，确保在不同主题下的视觉效果独立清晰，避免颜色混杂。

## 实现特性

### 1. 主题切换按钮
- **位置**: 右上角顶部工具栏
- **图标**: 月亮图标（亮色主题）/ 太阳图标（暗色主题）
- **动画**: 平滑的缩放和旋转过渡效果

### 2. 键盘快捷键
- **快捷键**: `Ctrl+Shift+T` (Windows/Linux) 或 `Cmd+Shift+T` (Mac)
- **功能**: 快速切换主题模式

### 3. 主题持久化
- **本地存储**: 用户选择的主题偏好保存到 localStorage
- **系统跟随**: 未设置偏好时自动跟随系统主题
- **优先级**: 用户偏好 > 系统偏好 > 默认浅色

### 4. 防闪烁机制
- **预加载脚本**: 在页面加载时立即设置主题
- **避免FOUC**: 防止无样式内容的闪烁

### 5. 专注模式增强
- **ESC退出**: 在专注模式下按ESC键可快速退出
- **优先级**: ESC键优先退出专注模式，然后才关闭搜索框
- **视觉提示**: 进入和退出专注模式时显示Toast提示消息

## 主题变量对比

### 亮色主题
```css
--bg-primary: #ffffff;
--bg-secondary: #f8fafc;
--text-primary: #1e293b;
--accent-green: #059669;
```

### 暗色主题
```css
--bg-primary: #0f172a;
--bg-secondary: #1e293b;
--text-primary: #f1f5f9;
--accent-green: #10b981;
```

## 优化细节

### 1. 过渡动画优化
- 使用快速过渡(`--transition-fast`)避免颜色混杂
- 背景效果立即切换，无过渡动画
- 主题切换期间添加特殊CSS状态

### 2. 背景效果独立性
- 亮色主题：浅绿色网格，低透明度
- 暗色主题：亮绿色网格，高透明度
- 扫描线效果在不同主题下使用不同颜色

### 3. 组件适配
- 搜索模态框暗色适配
- 滚动条样式优化
- 代码块、表格、引用块等内容的暗色支持

### 4. 专注模式优化
- 平滑的过渡动画和透明度变化
- 背景效果在专注模式下减弱
- 响应式适配，确保移动端体验

## 用户体验
- **即时反馈**: 切换时显示Toast提示消息
- **视觉一致性**: 确保所有UI组件在两种主题下都有良好的可读性
- **移动端优化**: 更新移动端浏览器的主题色
- **无障碍访问**: 保持良好的对比度
- **专注模式**: ESC键快速退出，直观的视觉反馈

## 技术实现

### 文件修改
1. `_layouts/default.html` - 添加主题切换按钮和预加载脚本
2. `assets/css/cyber-style.css` - 添加暗色主题变量和样式
3. `assets/js/cyber-ui.js` - 实现主题切换逻辑

### 核心方法
- `setupThemeToggle()` - 初始化主题切换功能
- `toggleTheme()` - 切换主题状态
- `setTheme(theme)` - 设置特定主题
- `loadThemePreference()` - 加载主题偏好
- `toggleZenMode()` - 专注模式切换（支持ESC退出）

## 键盘快捷键总览
- `Ctrl+K` / `Cmd+K` - 打开搜索
- `Ctrl+Shift+T` / `Cmd+Shift+T` - 切换主题
- `ESC` - 退出专注模式（优先）或关闭搜索框

## 浏览器兼容性
- 支持所有现代浏览器
- 使用标准CSS变量
- 优雅降级处理

## 使用说明
1. 点击右上角的月亮/太阳图标切换主题
2. 使用键盘快捷键 `Ctrl+Shift+T` 快速切换主题
3. 点击专注模式按钮进入专注模式，按ESC键退出
4. 主题偏好会自动保存，下次访问时自动应用
5. 未设置偏好时会跟随系统主题设置